#!/usr/bin/env python3
"""
æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
"""
import os
import sys

# å¤ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ¥åã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
old_db = "database_new.db"
backup_db = "database_new_backup.db"

if os.path.exists(old_db):
    print(f"æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ {backup_db} ã¨ã—ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¾ã™...")
    try:
        if os.path.exists(backup_db):
            os.remove(backup_db)
        os.rename(old_db, backup_db)
        print("ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†")
    except Exception as e:
        print(f"ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼: {e}")
        print("æ‰‹å‹•ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¦ãã ã•ã„")
        sys.exit(1)

# æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ
print("æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™...")
try:
    # modelsã‚’å…ˆã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã‚’èª­ã¿è¾¼ã‚€
    import models
    from database import Base, engine
      # ã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
    Base.metadata.create_all(bind=engine)
    
    print("âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ!")
    print("ğŸ“ æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«: database_new.db")
    print("ğŸ“ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«: database_new_backup.db")
    
except Exception as e:
    print(f"âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}")
    import traceback
    traceback.print_exc()
    sys.exit(1)
